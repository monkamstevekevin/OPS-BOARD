{"ast":null,"code":"import { signal } from '@angular/core';\nimport { RouterLink, RouterOutlet } from '@angular/router';\nimport { FormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./services/toast.service\";\nimport * as i2 from \"./services/api.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/common\";\nfunction AppComponent_span_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.missingCount());\n  }\n}\nfunction AppComponent_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const t_r2 = ctx.$implicit;\n    i0.ɵɵclassProp(\"ok\", t_r2.type === \"success\")(\"err\", t_r2.type === \"error\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", t_r2.text, \" \");\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(toastsSvc, api, router) {\n      this.toastsSvc = toastsSvc;\n      this.api = api;\n      this.router = router;\n      this.settingsOpen = signal(false);\n      this.baseUrl = localStorage.getItem('ops.baseUrl') || 'http://localhost:8060';\n      this.apiKey = localStorage.getItem('ops.apiKey') || '';\n      this.adminKey = localStorage.getItem('ops.adminKey') || '';\n      this.toasts = this.toastsSvc.toasts;\n      this.missingCount = signal(0);\n      this.pollMissing();\n    }\n    openSettings() {\n      this.settingsOpen.set(true);\n    }\n    closeSettings() {\n      this.settingsOpen.set(false);\n    }\n    save() {\n      localStorage.setItem('ops.baseUrl', this.baseUrl.trim());\n      localStorage.setItem('ops.apiKey', this.apiKey.trim());\n      localStorage.setItem('ops.adminKey', this.adminKey.trim());\n      this.closeSettings();\n    }\n    pollMissing() {\n      const run = () => {\n        this.api.liveAll().subscribe({\n          next: list => {\n            const count = (list || []).filter(x => x && x.vmState === 'missing').length;\n            const prev = this.missingCount();\n            this.missingCount.set(count);\n            if (prev === 0 && count > 0) {\n              this.toastsSvc.info(`Missing VMs detected (${count}). Open Discovery to reconcile.`);\n              try {\n                if (!this.router.url.includes('/admin/discovery')) this.router.navigate(['/admin/discovery']);\n              } catch {}\n            }\n          },\n          error: _ => {}\n        });\n      };\n      run();\n      this.missingTimer = setInterval(run, 30000);\n    }\n    ngOnDestroy() {\n      if (this.missingTimer) clearInterval(this.missingTimer);\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(t) {\n        return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.ToastService), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 37,\n        vars: 7,\n        consts: [[1, \"topbar\"], [1, \"brand\"], [1, \"nav\"], [\"routerLink\", \"/assets\", \"routerLinkActive\", \"active\"], [\"routerLink\", \"/alerts\", \"routerLinkActive\", \"active\"], [\"routerLink\", \"/admin\", \"routerLinkActive\", \"active\"], [\"routerLink\", \"/admin/discovery\", \"routerLinkActive\", \"active\"], [\"class\", \"badge\", 4, \"ngIf\"], [1, \"btn\", 3, \"click\"], [1, \"container\"], [1, \"drawer\"], [1, \"drawer-content\"], [\"type\", \"text\", \"placeholder\", \"http://localhost:8060\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"password\", \"placeholder\", \"optional\", 3, \"ngModelChange\", \"ngModel\"], [1, \"drawer-actions\"], [1, \"btn\", \"primary\", 3, \"click\"], [1, \"toasts\"], [\"class\", \"toast\", 3, \"ok\", \"err\", 4, \"ngFor\", \"ngForOf\"], [1, \"badge\"], [1, \"toast\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"header\", 0)(1, \"div\", 1);\n            i0.ɵɵtext(2, \"CAUREQ Ops Board\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"nav\", 2)(4, \"a\", 3);\n            i0.ɵɵtext(5, \"Assets\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"a\", 4);\n            i0.ɵɵtext(7, \"Alerts\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"a\", 5);\n            i0.ɵɵtext(9, \"Admin\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(10, \"a\", 6);\n            i0.ɵɵtext(11, \"Discovery \");\n            i0.ɵɵtemplate(12, AppComponent_span_12_Template, 2, 1, \"span\", 7);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_13_listener() {\n              return ctx.openSettings();\n            });\n            i0.ɵɵtext(14, \"Settings\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(15, \"div\", 9);\n            i0.ɵɵelement(16, \"router-outlet\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"div\", 10)(18, \"div\", 11)(19, \"h2\");\n            i0.ɵɵtext(20, \"Param\\u00E8tres\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"label\");\n            i0.ɵɵtext(22, \"API Base URL \");\n            i0.ɵɵelementStart(23, \"input\", 12);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AppComponent_Template_input_ngModelChange_23_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.baseUrl, $event) || (ctx.baseUrl = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(24, \"label\");\n            i0.ɵɵtext(25, \"X-API-KEY \");\n            i0.ɵɵelementStart(26, \"input\", 13);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AppComponent_Template_input_ngModelChange_26_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.apiKey, $event) || (ctx.apiKey = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(27, \"label\");\n            i0.ɵɵtext(28, \"X-ADMIN-API-KEY \");\n            i0.ɵɵelementStart(29, \"input\", 13);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AppComponent_Template_input_ngModelChange_29_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.adminKey, $event) || (ctx.adminKey = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(30, \"div\", 14)(31, \"button\", 15);\n            i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_31_listener() {\n              return ctx.save();\n            });\n            i0.ɵɵtext(32, \"Save\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_33_listener() {\n              return ctx.closeSettings();\n            });\n            i0.ɵɵtext(34, \"Close\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(35, \"div\", 16);\n            i0.ɵɵtemplate(36, AppComponent_div_36_Template, 2, 5, \"div\", 17);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(12);\n            i0.ɵɵproperty(\"ngIf\", ctx.missingCount() > 0);\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"hidden\", !ctx.settingsOpen());\n            i0.ɵɵadvance(6);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.baseUrl);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.apiKey);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.adminKey);\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"ngForOf\", ctx.toasts());\n          }\n        },\n        dependencies: [RouterOutlet, RouterLink, FormsModule, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, CommonModule, i5.NgForOf, i5.NgIf],\n        encapsulation: 2\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}