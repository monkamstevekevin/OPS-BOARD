{"ast":null,"code":"import { signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/api.service\";\nimport * as i2 from \"@angular/forms\";\nexport let AdminComponent = /*#__PURE__*/(() => {\n  class AdminComponent {\n    constructor(api) {\n      this.api = api;\n      this.node = localStorage.getItem('ops.defaultNode') || '';\n      this.vmid = '';\n      this.prog = '';\n      this.args = '';\n      this.stdin = '';\n      this.timeout = '10';\n      this.out = signal('');\n      // Bulk\n      this.bulkTag = '';\n      this.bulkHosts = '';\n      this.bulkAction = 'start';\n    }\n    request(obs, label) {\n      this.out.set('Loading...');\n      obs.subscribe({\n        next: r => this.out.set(`${label}: ` + JSON.stringify(r, null, 2)),\n        error: e => this.out.set('Erreur: ' + (e.message || e))\n      });\n    }\n    saveNode() {\n      if (this.node && this.node.trim()) localStorage.setItem('ops.defaultNode', this.node.trim());\n    }\n    start() {\n      this.saveNode();\n      this.request(this.api.adminStart(this.node, +this.vmid), 'start');\n    }\n    shutdown() {\n      this.saveNode();\n      this.request(this.api.adminShutdown(this.node, +this.vmid), 'shutdown');\n    }\n    stop() {\n      this.saveNode();\n      this.request(this.api.adminStop(this.node, +this.vmid), 'stop');\n    }\n    reset() {\n      this.saveNode();\n      this.request(this.api.adminReset(this.node, +this.vmid), 'reset');\n    }\n    exec() {\n      this.saveNode();\n      const cmd = [this.prog, ...this.args.split(' ').filter(Boolean)];\n      const t = parseInt(String(this.timeout || '10'), 10);\n      this.request(this.api.adminExec(this.node, +this.vmid, cmd, this.stdin, t), 'exec');\n    }\n    bulk() {\n      const hostnames = this.bulkHosts.split(/\\r?\\n/).map(s => s.trim()).filter(Boolean);\n      const tag = this.bulkTag.trim() || undefined;\n      this.out.set('Loading...');\n      this.api.adminBulk(this.bulkAction, {\n        hostnames: hostnames.length ? hostnames : undefined,\n        tag\n      }).subscribe({\n        next: r => this.out.set(JSON.stringify(r, null, 2)),\n        error: e => this.out.set('Erreur: ' + (e.message || e))\n      });\n    }\n    static {\n      this.ɵfac = function AdminComponent_Factory(t) {\n        return new (t || AdminComponent)(i0.ɵɵdirectiveInject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AdminComponent,\n        selectors: [[\"app-admin\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 82,\n        vars: 10,\n        consts: [[1, \"card\"], [1, \"toolbar\"], [1, \"col\"], [\"placeholder\", \"ex: Caureqlab\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"number\", \"placeholder\", \"ex: 101\", 3, \"ngModelChange\", \"ngModel\"], [1, \"col\", 2, \"align-self\", \"center\"], [1, \"actions\"], [1, \"btn\", \"primary\", 3, \"click\"], [1, \"btn\", 3, \"click\"], [1, \"actions\", 2, \"margin-top\", \"8px\"], [\"placeholder\", \"ex: cmd.exe ou bash\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"ex: /c whoami ou -lc whoami\", 3, \"ngModelChange\", \"ngModel\"], [\"rows\", \"3\", 3, \"ngModelChange\", \"ngModel\"], [1, \"row\"], [\"type\", \"number\", \"placeholder\", \"10\", 3, \"ngModelChange\", \"ngModel\"], [3, \"ngModelChange\", \"ngModel\"], [\"value\", \"start\"], [\"value\", \"shutdown\"], [\"value\", \"stop\"], [\"value\", \"reset\"], [\"placeholder\", \"tag name\", 3, \"ngModelChange\", \"ngModel\"], [\"rows\", \"4\", \"placeholder\", \"vm-101-web\\nvm-102-db\", 3, \"ngModelChange\", \"ngModel\"], [1, \"muted\"]],\n        template: function AdminComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h3\");\n            i0.ɵɵtext(2, \"Actions Admin\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"div\", 1)(4, \"div\", 2)(5, \"label\");\n            i0.ɵɵtext(6, \"Node\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"input\", 3);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_input_ngModelChange_7_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.node, $event) || (ctx.node = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(8, \"div\", 2)(9, \"label\");\n            i0.ɵɵtext(10, \"VMID\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_input_ngModelChange_11_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.vmid, $event) || (ctx.vmid = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"div\", 5)(13, \"div\", 6)(14, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_14_listener() {\n              return ctx.start();\n            });\n            i0.ɵɵtext(15, \"Start\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_16_listener() {\n              return ctx.shutdown();\n            });\n            i0.ɵɵtext(17, \"Shutdown\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_18_listener() {\n              return ctx.stop();\n            });\n            i0.ɵɵtext(19, \"Stop\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_20_listener() {\n              return ctx.reset();\n            });\n            i0.ɵɵtext(21, \"Reset\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(22, \"div\", 9)(23, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_23_listener() {\n              return ctx.start();\n            });\n            i0.ɵɵtext(24, \"Start\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_25_listener() {\n              return ctx.shutdown();\n            });\n            i0.ɵɵtext(26, \"Shutdown\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(27, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_27_listener() {\n              return ctx.stop();\n            });\n            i0.ɵɵtext(28, \"Stop\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(29, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_29_listener() {\n              return ctx.reset();\n            });\n            i0.ɵɵtext(30, \"Reset\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(31, \"hr\");\n            i0.ɵɵelementStart(32, \"h3\");\n            i0.ɵɵtext(33, \"Exec via QGA\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(34, \"div\", 1)(35, \"div\", 2)(36, \"label\");\n            i0.ɵɵtext(37, \"Program\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(38, \"input\", 10);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_input_ngModelChange_38_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.prog, $event) || (ctx.prog = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(39, \"div\", 2)(40, \"label\");\n            i0.ɵɵtext(41, \"Args\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(42, \"input\", 11);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_input_ngModelChange_42_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.args, $event) || (ctx.args = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(43, \"div\", 5)(44, \"button\", 8);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_44_listener() {\n              return ctx.exec();\n            });\n            i0.ɵɵtext(45, \"Exec\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(46, \"label\");\n            i0.ɵɵtext(47, \"STDIN (optional)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(48, \"textarea\", 12);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_textarea_ngModelChange_48_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.stdin, $event) || (ctx.stdin = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(49, \"div\", 13)(50, \"div\", 2)(51, \"label\");\n            i0.ɵɵtext(52, \"Timeout (sec)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(53, \"input\", 14);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_input_ngModelChange_53_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.timeout, $event) || (ctx.timeout = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(54, \"div\", 0)(55, \"h3\");\n            i0.ɵɵtext(56, \"Bulk VM Actions\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(57, \"div\", 1)(58, \"div\", 2)(59, \"label\");\n            i0.ɵɵtext(60, \"Action\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(61, \"select\", 15);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_select_ngModelChange_61_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.bulkAction, $event) || (ctx.bulkAction = $event);\n              return $event;\n            });\n            i0.ɵɵelementStart(62, \"option\", 16);\n            i0.ɵɵtext(63, \"Start\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(64, \"option\", 17);\n            i0.ɵɵtext(65, \"Shutdown\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(66, \"option\", 18);\n            i0.ɵɵtext(67, \"Stop\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(68, \"option\", 19);\n            i0.ɵɵtext(69, \"Reset\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(70, \"div\", 2)(71, \"label\");\n            i0.ɵɵtext(72, \"Tag (optional)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(73, \"input\", 20);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_input_ngModelChange_73_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.bulkTag, $event) || (ctx.bulkTag = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(74, \"div\", 5)(75, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function AdminComponent_Template_button_click_75_listener() {\n              return ctx.bulk();\n            });\n            i0.ɵɵtext(76, \"Run Bulk\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(77, \"label\");\n            i0.ɵɵtext(78, \"Hostnames (one per line, optional)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(79, \"textarea\", 21);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AdminComponent_Template_textarea_ngModelChange_79_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.bulkHosts, $event) || (ctx.bulkHosts = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(80, \"pre\", 22);\n            i0.ɵɵtext(81);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(7);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.node);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.vmid);\n            i0.ɵɵadvance(27);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.prog);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.args);\n            i0.ɵɵadvance(6);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.stdin);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.timeout);\n            i0.ɵɵadvance(8);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.bulkAction);\n            i0.ɵɵadvance(12);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.bulkTag);\n            i0.ɵɵadvance(6);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.bulkHosts);\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate(ctx.out());\n          }\n        },\n        dependencies: [CommonModule, FormsModule, i2.NgSelectOption, i2.ɵNgSelectMultipleOption, i2.DefaultValueAccessor, i2.NumberValueAccessor, i2.SelectControlValueAccessor, i2.NgControlStatus, i2.NgModel],\n        encapsulation: 2\n      });\n    }\n  }\n  return AdminComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}