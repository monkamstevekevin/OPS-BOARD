{"ast":null,"code":"import { signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/api.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction AlertsComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Erreur: \", ctx_r0.error(), \"\");\n  }\n}\nfunction AlertsComponent_table_35_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\")(11, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function AlertsComponent_table_35_tr_14_Template_button_click_11_listener() {\n      const a_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.ack(a_r3.id));\n    });\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const a_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(3, 6, a_r3.ts, \"short\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(a_r3.hostname);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r3.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r3.message);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", a_r3.acknowledged);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(a_r3.acknowledged ? \"Acked\" : \"Ack\");\n  }\n}\nfunction AlertsComponent_table_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 14)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Time\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Host\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Message\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Ack\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"tbody\");\n    i0.ɵɵtemplate(14, AlertsComponent_table_35_tr_14_Template, 13, 9, \"tr\", 15);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(14);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.alerts());\n  }\n}\nfunction AlertsComponent_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \"No alerts\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let AlertsComponent = /*#__PURE__*/(() => {\n  class AlertsComponent {\n    constructor(api) {\n      this.api = api;\n      this.alerts = signal([]);\n      this.error = signal(null);\n      this.cpuTh = 90;\n      this.ramTh = 90;\n      this.dskTh = 95;\n      this.filterHost = '';\n      this.filterAck = 'ALL';\n      this.load();\n      this.timer = setInterval(() => this.load(), 15000);\n      this.loadCfg();\n    }\n    load() {\n      const params = {};\n      if (this.filterHost.trim()) params.host = this.filterHost.trim();\n      if (this.filterAck === 'ACK') params.ack = true;\n      if (this.filterAck === 'UNACK') params.ack = false;\n      this.api.listAlerts(params).subscribe({\n        next: l => {\n          this.alerts.set(l);\n          this.error.set(null);\n        },\n        error: e => this.error.set(e.message || 'error')\n      });\n    }\n    ack(id) {\n      this.api.ackAlert(id).subscribe({\n        next: _ => this.load(),\n        error: e => this.error.set(e.message || 'error')\n      });\n    }\n    loadCfg() {\n      this.api.getAlertsConfig().subscribe({\n        next: c => {\n          this.cpuTh = c.cpuHighPct;\n          this.ramTh = c.ramHighPct;\n          this.dskTh = c.diskHighPct;\n        },\n        error: _ => {}\n      });\n    }\n    saveCfg() {\n      this.api.updateAlertsConfig({\n        cpuHighPct: this.cpuTh,\n        ramHighPct: this.ramTh,\n        diskHighPct: this.dskTh\n      }).subscribe({\n        next: _ => {},\n        error: e => this.error.set(e.message || 'error')\n      });\n    }\n    ngOnDestroy() {\n      if (this.timer) clearInterval(this.timer);\n    }\n    refreshListDebounced() {\n      if (this.searchTimer) clearTimeout(this.searchTimer);\n      this.searchTimer = setTimeout(() => this.load(), 400);\n    }\n    static {\n      this.ɵfac = function AlertsComponent_Factory(t) {\n        return new (t || AlertsComponent)(i0.ɵɵdirectiveInject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AlertsComponent,\n        selectors: [[\"app-alerts\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 37,\n        vars: 8,\n        consts: [[1, \"card\"], [\"class\", \"muted\", 4, \"ngIf\"], [1, \"toolbar\", 2, \"margin-bottom\", \"8px\"], [1, \"col\"], [\"type\", \"number\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [1, \"input-group\"], [1, \"icon\"], [\"placeholder\", \"hostname...\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [3, \"ngModelChange\", \"change\", \"ngModel\"], [\"value\", \"ALL\"], [\"value\", \"UNACK\"], [\"value\", \"ACK\"], [\"class\", \"assets-table\", 4, \"ngIf\"], [1, \"muted\"], [1, \"assets-table\"], [4, \"ngFor\", \"ngForOf\"], [1, \"btn\", 3, \"click\", \"disabled\"]],\n        template: function AlertsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h3\");\n            i0.ɵɵtext(2, \"Alerts\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(3, AlertsComponent_div_3_Template, 2, 1, \"div\", 1);\n            i0.ɵɵelementStart(4, \"div\", 2)(5, \"div\", 3)(6, \"label\");\n            i0.ɵɵtext(7, \"CPU high %\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AlertsComponent_Template_input_ngModelChange_8_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.cpuTh, $event) || (ctx.cpuTh = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function AlertsComponent_Template_input_change_8_listener() {\n              return ctx.saveCfg();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"div\", 3)(10, \"label\");\n            i0.ɵɵtext(11, \"RAM high %\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AlertsComponent_Template_input_ngModelChange_12_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.ramTh, $event) || (ctx.ramTh = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function AlertsComponent_Template_input_change_12_listener() {\n              return ctx.saveCfg();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"div\", 3)(14, \"label\");\n            i0.ɵɵtext(15, \"Disk high %\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AlertsComponent_Template_input_ngModelChange_16_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.dskTh, $event) || (ctx.dskTh = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function AlertsComponent_Template_input_change_16_listener() {\n              return ctx.saveCfg();\n            });\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(17, \"div\", 2)(18, \"div\", 3)(19, \"label\");\n            i0.ɵɵtext(20, \"Filter host\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"div\", 5)(22, \"span\", 6);\n            i0.ɵɵtext(23, \"\\uD83D\\uDD0E\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"input\", 7);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AlertsComponent_Template_input_ngModelChange_24_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterHost, $event) || (ctx.filterHost = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function AlertsComponent_Template_input_input_24_listener() {\n              return ctx.refreshListDebounced();\n            });\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(25, \"div\", 3)(26, \"label\");\n            i0.ɵɵtext(27, \"Status\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"select\", 8);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AlertsComponent_Template_select_ngModelChange_28_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterAck, $event) || (ctx.filterAck = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function AlertsComponent_Template_select_change_28_listener() {\n              return ctx.load();\n            });\n            i0.ɵɵelementStart(29, \"option\", 9);\n            i0.ɵɵtext(30, \"All\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(31, \"option\", 10);\n            i0.ɵɵtext(32, \"Unacknowledged\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"option\", 11);\n            i0.ɵɵtext(34, \"Acknowledged\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(35, AlertsComponent_table_35_Template, 15, 1, \"table\", 12)(36, AlertsComponent_div_36_Template, 2, 0, \"div\", 1);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.error());\n            i0.ɵɵadvance(5);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.cpuTh);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.ramTh);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.dskTh);\n            i0.ɵɵadvance(8);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterHost);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterAck);\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"ngIf\", ctx.alerts().length);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.alerts().length && !ctx.error());\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, i2.DatePipe, FormsModule, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgModel],\n        encapsulation: 2\n      });\n    }\n  }\n  return AlertsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}